<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ paste.title|default:"untitled" }} | skibin.lol</title>

    <!-- Open Graph / Facebook Meta Tags -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ request.build_absolute_uri }}">
    <meta property="og:title" content="{{ paste.title|default:'untitled paste' }} | skibin.lol">
    <meta property="og:description" content="{{ paste.content|truncatechars:150|default:'Code snippet shared on skibin.lol' }}">
    <meta property="og:site_name" content="skibin.lol">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:url" content="{{ request.build_absolute_uri }}">
    <meta name="twitter:title" content="{{ paste.title|default:'untitled paste' }} | skibin.lol">
    <meta name="twitter:description" content="{{ paste.content|truncatechars:150|default:'Code snippet shared on skibin.lol' }}">
    
    <!-- Discord-specific Meta Tags -->
    <meta property="og:site_name" content="skibin.lol">
    <meta name="theme-color" content="#f97316">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Configure Tailwind for dark mode -->
    <script>
        tailwind.config = {
            darkMode: 'class'
        }
    </script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@300;400;500&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Highlight.js for syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>

    <!-- Google Ads -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5653411333184686"
     crossorigin="anonymous"></script>

    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            min-height: 100vh;
        }
        
        .dark body {
            background: linear-gradient(135deg, #111827 0%, #1f2937 100%) !important;
        }
        
        .gradient-text {
            background: linear-gradient(90deg, #f97316, #db2777, #7c3aed);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            display: inline-block;
        }
        
        .btn-3d {
            transform: translateY(0);
            transition: all 0.2s ease;
            box-shadow: 0 4px 0 rgba(0, 0, 0, 0.1);
        }
        
        .btn-3d:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 0 rgba(0, 0, 0, 0.1);
        }
        
        .btn-3d:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 rgba(0, 0, 0, 0.1);
        }
        
        .code-container {
            background: #0d1117;
            border-radius: 12px;
            overflow: hidden;
            font-family: 'JetBrains Mono', monospace;
            position: relative;
        }
        
        .code-content {
            padding: 20px;
            color: #c9d1d9;
            font-size: 14px;
            line-height: 1.5;
            overflow-x: auto;
        }
        
        .line-numbers {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 50px;
            background: #161b22;
            color: #8b949e;
            text-align: right;
            padding: 20px 8px;
            font-size: 14px;
            line-height: 1.5;
            user-select: none;
            border-right: 1px solid #30363d;
        }
        
        .language-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: rgba(249, 115, 22, 0.1);
            border: 1px solid rgba(249, 115, 22, 0.2);
            color: #f97316;
        }
        
        .expiry-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.2);
            color: #3b82f6;
        }
        
        /* Custom scrollbar for page */
        ::-webkit-scrollbar {
            width: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 10px;
        }
        
        .dark ::-webkit-scrollbar-track {
            background: #374151;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #f97316, #db2777);
            border-radius: 10px;
        }
        
        .dark ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #ea580c, #be185d);
        }
        
        /* Glass effect for nav */
        .glass-effect {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .dark .glass-effect {
            background: rgba(31, 41, 55, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(75, 85, 99, 0.2);
        }
        
        /* Custom form input for URL */
        .url-input {
            width: 100%;
            padding: 12px 16px;
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 12px;
            font-size: 14px;
            color: #1f2937;
            outline: none;
            font-family: 'JetBrains Mono', monospace;
        }
        
        .dark .url-input {
            background: #374151;
            border-color: #4b5563;
            color: #f3f4f6;
        }
        
        .url-input:focus {
            border-color: #f97316;
            box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.1);
        }
        
        .dark .url-input:focus {
            border-color: #f97316;
            box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.2);
        }
        
        /* Ad container styling - FIXED */
        .ad-container {
            width: 100% !important;
            min-width: 300px !important;
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            margin: 0 auto;
        }
        
        .ad-label {
            font-size: 11px;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 8px;
        }
        
        .dark .ad-label {
            color: #9ca3af;
        }
        
        /* Fix for Google Ads container */
        ins.adsbygoogle {
            display: block !important;
            width: 100% !important;
            min-width: 300px !important;
            margin: 0 auto;
        }
        
        /* Mobile vertical ad */
        .vertical-ad ins.adsbygoogle {
            min-height: 250px !important;
            height: 250px !important;
        }
        
        /* Desktop horizontal ad */
        .horizontal-ad ins.adsbygoogle {
            min-height: 90px !important;
            height: 90px !important;
        }
        
        /* Admin badge styles */
        .admin-badge {
            background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
            color: white;
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { box-shadow: 0 0 10px rgba(139, 92, 246, 0.5); }
            to { box-shadow: 0 0 20px rgba(139, 92, 246, 0.8); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Loading placeholder for ads */
        .ad-placeholder {
            width: 100%;
            height: 250px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #f1f5f9 0%, #e5e7eb 100%);
            border-radius: 12px;
            color: #6b7280;
        }
        
        .dark .ad-placeholder {
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
            color: #9ca3af;
        }
        
        .ad-placeholder i {
            font-size: 2rem;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-100 transition-colors duration-300">
    <amp-auto-ads type="adsense"
        data-ad-client="ca-pub-5653411333184686">
    </amp-auto-ads>
    
    <!-- Navigation -->
    <nav class="sticky top-0 z-50 glass-effect border-b border-gray-200 dark:border-gray-700">
        <div class="container mx-auto px-4 py-3">
            <div class="flex items-center justify-between">
                <a href="{% url 'home' %}" class="flex items-center space-x-2">
                    <span class="text-2xl">üìù</span>
                    <h1 class="text-xl font-bold gradient-text">skibin.lol</h1>
                </a>
                
                <div class="flex items-center space-x-4">
                    <!-- Dark Mode Toggle -->
                    <button id="darkModeToggle" 
                            class="p-2 rounded-full bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 
                                   transition-all duration-300">
                        <span id="darkIcon" class="hidden text-lg">üåô</span>
                        <span id="lightIcon" class="text-lg">‚òÄÔ∏è</span>
                    </button>
                    <a href="{% url 'create_paste' %}" class="text-gray-600 dark:text-gray-300 hover:text-pink-600 dark:hover:text-pink-400 font-medium text-sm">
                        + new paste
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <div class="max-w-6xl mx-auto">
            <!-- Paste Header -->
            <div class="mb-8">
                <div class="flex flex-wrap items-center justify-between gap-4 mb-4">
                    <div>
                        <h1 class="text-3xl md:text-4xl font-bold gradient-text">
                            {{ paste.title|default:"untitled" }}
                        </h1>
                        
                        <!-- ADMIN BADGE (Hidden in HTML, shown via JS) -->
                        {% with title=paste.title|default:"" %}
                            {% if "[Xfz.xsae23;sd]" in title %}
                                <div class="mt-3 opacity-0 transition-opacity duration-500" id="admin-badge">
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-bold admin-badge">
                                        <i class="fas fa-crown mr-2"></i>
                                        posted by admin
                                        <span class="ml-2 text-xs opacity-75">‚úì verified</span>
                                    </span>
                                </div>
                            {% endif %}
                        {% endwith %}
                    </div>
                    
                    <div class="flex items-center gap-3">
                        <div class="language-badge">
                            <i class="fas fa-code"></i>
                            <span>{{ paste.get_language_display }}</span>
                        </div>
                        <div class="expiry-badge">
                            <i class="fas fa-clock"></i>
                            <span>expires {{ paste.expires_at|date:"M d, Y" }}</span>
                        </div>
                    </div>
                </div>
                
                <div class="flex flex-wrap items-center gap-6 text-sm text-gray-600 dark:text-gray-400">
                    <div class="flex items-center">
                        <i class="fas fa-eye mr-2"></i>
                        <span>{{ paste.views }} view{{ paste.views|pluralize }}</span>
                    </div>
                    <div class="flex items-center">
                        <i class="fas fa-calendar-plus mr-2"></i>
                        <span>created {{ paste.created_at|date:"M d, Y" }}</span>
                    </div>
                    <div class="flex items-center">
                        <i class="fas fa-link mr-2"></i>
                        <span class="font-mono bg-gray-100 dark:bg-gray-800 px-2 py-1 rounded">skibin.lol/p/{{ paste.id }}</span>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex flex-wrap gap-3 mb-6">
                <a href="{% url 'raw_paste' paste.id %}" target="_blank" class="px-4 py-2 bg-white dark:bg-gray-800 border-2 border-gray-300 dark:border-gray-700 text-gray-800 dark:text-gray-200 font-medium rounded-xl hover:border-pink-400 transition flex items-center">
                    <i class="fas fa-file-alt mr-2"></i> raw
                </a>
                <a href="{% url 'clone_paste' paste.id %}" class="px-4 py-2 bg-white dark:bg-gray-800 border-2 border-gray-300 dark:border-gray-700 text-gray-800 dark:text-gray-200 font-medium rounded-xl hover:border-pink-400 transition flex items-center">
                    <i class="fas fa-copy mr-2"></i> clone
                </a>
                <button onclick="copyToClipboard()" class="px-4 py-2 bg-gradient-to-r from-orange-500 to-pink-600 text-white font-medium rounded-xl btn-3d flex items-center">
                    <i class="fas fa-copy mr-2"></i> copy link
                </button>
                <button onclick="copyContent()" class="px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-600 text-white font-medium rounded-xl btn-3d flex items-center">
                    <i class="fas fa-clipboard mr-2"></i> copy content
                </button>
            </div>
            
            <!--
            <div class="mb-6 md:hidden vertical-ad">
                <div class="text-center ad-label">
                    <i class="fas fa-ad mr-1"></i> advertisement
                </div>
                <div class="ad-container bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-900/20 dark:to-cyan-900/20 
                            border border-blue-100 dark:border-blue-800 p-4">
                    <ins class="adsbygoogle"
                         style="display:block;"
                         data-ad-client="ca-pub-5653411333184686"
                         data-ad-slot="9694246869"
                         data-full-width-responsive="true"></ins>
                </div>
                <div class="text-center text-xs text-gray-500 dark:text-gray-400 mt-2">
                    ads help keep skibin.lol free
                </div>
            </div>
            -->
            
            <!-- Code Display -->
            <div class="code-container mb-8">
                <div class="line-numbers" id="line-numbers">
                    {% for line in content_lines %}
                    <div>{{ forloop.counter }}</div>
                    {% endfor %}
                </div>
                <div class="code-content" style="padding-left: 70px;">
                    <pre><code id="code-content" class="language-{{ paste.language }} hljs">{{ paste.content }}</code></pre>
                </div>
            </div>
            
            <!--
            <div class="mb-8 hidden md:block horizontal-ad">
                <div class="text-center ad-label">
                    <i class="fas fa-ad mr-1"></i> advertisement
                </div>
                <div class="ad-container bg-gradient-to-br from-orange-50 to-pink-50 dark:from-orange-900/20 dark:to-pink-900/20 
                            border border-orange-100 dark:border-orange-800 p-4">
                    <ins class="adsbygoogle"
                         style="display:block;"
                         data-ad-client="ca-pub-5653411333184686"
                         data-ad-slot="4014367161"
                         data-full-width-responsive="true"></ins>
                </div>
                <div class="text-center text-xs text-gray-500 dark:text-gray-400 mt-2">
                    consider disabling ad blockers to support skibin.lol
                </div>
            </div>
            -->
            
            <!-- Share Section -->
            <div class="bg-gradient-to-r from-orange-50 to-pink-50 dark:from-orange-900/20 dark:to-pink-900/20 
                        border border-orange-100 dark:border-orange-800 rounded-2xl p-6 mb-8">
                <h3 class="text-lg font-bold mb-3 dark:text-gray-200">
                    <i class="fas fa-share-alt mr-2"></i>share this paste
                </h3>
                <div class="flex flex-wrap items-center gap-4">
                    <div class="flex-1 min-w-[300px]">
                        <div class="relative">
                            <input type="text" 
                                   id="paste-url" 
                                   value="{{ request.build_absolute_uri }}" 
                                   readonly 
                                   class="url-input pr-10">
                            <button onclick="copyToClipboard()" class="absolute right-3 top-1/2 transform -translate-y-1/2 p-2 text-gray-500 dark:text-gray-400 hover:text-pink-600 dark:hover:text-pink-400">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                    <div class="text-sm text-gray-600 dark:text-gray-400">
                        <i class="fas fa-info-circle mr-1"></i>
                        only people with this link can view
                    </div>
                </div>
            </div>
            
            <!-- Info -->
            <div class="text-center text-gray-500 dark:text-gray-400 text-sm">
                <p>
                    <i class="fas fa-lock mr-1"></i>
                    private paste ‚Ä¢ auto-deletes after 3 months ‚Ä¢ no accounts needed
                </p>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="mt-12 border-t border-gray-200 dark:border-gray-800">
        <div class="container mx-auto px-4 py-6">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="flex items-center space-x-2 mb-4 md:mb-0">
                    <span class="text-xl">üìù</span>
                    <span class="font-bold gradient-text">skibin.lol</span>
                </div>
                
                <div class="flex space-x-6 text-gray-600 dark:text-gray-400 text-sm">
                    <a href="{% url 'home' %}" class="hover:text-pink-600 dark:hover:text-pink-400">home</a>
                    <a href="{% url 'create_paste' %}" class="hover:text-pink-600 dark:hover:text-pink-400">create paste</a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Initialize highlight.js
        hljs.highlightAll();
        
        // Initialize Google Ads AFTER page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Show admin badge with delay (security)
            const adminBadge = document.getElementById('admin-badge');
            if (adminBadge) {
                setTimeout(() => {
                    adminBadge.classList.remove('opacity-0');
                    adminBadge.classList.add('opacity-100');
                    adminBadge.style.animation = 'fadeIn 0.5s ease-out';
                }, 500);
            }
            
            // Update line numbers if needed
            const codeContent = document.getElementById('code-content');
            const lines = codeContent.textContent.split('\n').length;
            const lineNumbersElement = document.getElementById('line-numbers');
            
            if (lineNumbersElement.children.length === 0) {
                let lineNumbersHTML = '';
                for (let i = 1; i <= lines; i++) {
                    lineNumbersHTML += `<div>${i}</div>`;
                }
                lineNumbersElement.innerHTML = lineNumbersHTML;
            }
            
            // Wait for layout to calculate widths before loading ads
            setTimeout(() => {
                try {
                    // Force ad containers to have width
                    document.querySelectorAll('.adsbygoogle').forEach(ad => {
                        ad.style.width = '100%';
                        ad.style.minWidth = '300px';
                        ad.style.display = 'block';
                    });
                    
                    // Initialize ads
                    (adsbygoogle = window.adsbygoogle || []).push({});
                    console.log('Ads initialized successfully');
                    
                    // Check if ads loaded after 2 seconds
                    setTimeout(() => {
                        document.querySelectorAll('.adsbygoogle').forEach(ad => {
                            if (ad.offsetHeight < 50) {
                                console.log('Ad might be blocked or not loaded:', ad);
                            }
                        });
                    }, 2000);
                    
                } catch (error) {
                    console.log('Ad initialization error:', error);
                    // Retry after 1 second
                    setTimeout(() => {
                        try {
                            (adsbygoogle = window.adsbygoogle || []).push({});
                        } catch (e) {
                            console.log('Failed to load ads after retry');
                        }
                    }, 1000);
                }
            }, 500); // Wait 500ms for page layout
            
            // Copy URL to clipboard
            window.copyToClipboard = function() {
                const urlInput = document.getElementById('paste-url');
                urlInput.select();
                urlInput.setSelectionRange(0, 99999);
                navigator.clipboard.writeText(urlInput.value).then(() => {
                    const copyBtn = urlInput.nextElementSibling;
                    const originalHTML = copyBtn.innerHTML;
                    copyBtn.innerHTML = '<i class="fas fa-check"></i>';
                    copyBtn.classList.add('text-green-500');
                    
                    setTimeout(() => {
                        copyBtn.innerHTML = originalHTML;
                        copyBtn.classList.remove('text-green-500');
                    }, 2000);
                });
            };
            
            // Copy content to clipboard
            window.copyContent = function() {
                const codeElement = document.getElementById('code-content');
                navigator.clipboard.writeText(codeElement.textContent).then(() => {
                    const copyBtn = document.querySelector('button[onclick="copyContent()"]');
                    const originalHTML = copyBtn.innerHTML;
                    copyBtn.innerHTML = '<i class="fas fa-check mr-2"></i> copied!';
                    copyBtn.classList.remove('from-blue-500', 'to-purple-600');
                    copyBtn.classList.add('from-green-500', 'to-green-600');
                    
                    setTimeout(() => {
                        copyBtn.innerHTML = originalHTML;
                        copyBtn.classList.remove('from-green-500', 'to-green-600');
                        copyBtn.classList.add('from-blue-500', 'to-purple-600');
                    }, 2000);
                });
            };
            
            // Select URL text on click
            document.getElementById('paste-url').addEventListener('click', function() {
                this.select();
            });
        });
        
        // === DARK MODE TOGGLE ===
        const darkModeToggle = document.getElementById('darkModeToggle');
        const darkIcon = document.getElementById('darkIcon');
        const lightIcon = document.getElementById('lightIcon');
        
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const savedTheme = localStorage.getItem('skibin-theme');
        
        if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
            enableDarkMode();
        } else {
            disableDarkMode();
        }
        
        darkModeToggle.addEventListener('click', () => {
            if (document.documentElement.classList.contains('dark')) {
                disableDarkMode();
            } else {
                enableDarkMode();
            }
        });
        
        function enableDarkMode() {
            document.documentElement.classList.add('dark');
            darkIcon.classList.remove('hidden');
            lightIcon.classList.add('hidden');
            localStorage.setItem('skibin-theme', 'dark');
        }
        
        function disableDarkMode() {
            document.documentElement.classList.remove('dark');
            darkIcon.classList.add('hidden');
            lightIcon.classList.remove('hidden');
            localStorage.setItem('skibin-theme', 'light');
        }
        
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
            if (!localStorage.getItem('skibin-theme')) {
                if (e.matches) {
                    enableDarkMode();
                } else {
                    disableDarkMode();
                }
            }
        });
        
        // Check for ad blockers (gentle message)
        setTimeout(function() {
            const adElements = document.querySelectorAll('.adsbygoogle');
            let anyAdBlocked = false;
            
            adElements.forEach(ad => {
                if (ad.offsetHeight < 50 && ad.offsetWidth < 50) {
                    anyAdBlocked = true;
                }
            });
            
            if (anyAdBlocked && Math.random() < 0.3) { // 30% chance to show message
                const message = document.createElement('div');
                message.className = 'text-center text-sm text-gray-600 dark:text-gray-400 mt-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg';
                message.innerHTML = `
                    <i class="fas fa-heart text-red-500 mr-2"></i>
                    <span>Ads help keep skibin.lol free. Consider disabling ad blockers to support us.</span>
                `;
                
                // Add to first ad container
                const firstAdContainer = document.querySelector('.ad-container');
                if (firstAdContainer) {
                    firstAdContainer.parentNode.insertBefore(message, firstAdContainer.nextSibling);
                }
            }
        }, 4000);
    </script>
</body>
</html>
